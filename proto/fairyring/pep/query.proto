syntax = "proto3";

package fairyring.pep;

import "amino/amino.proto";
import "cosmos/base/query/v1beta1/pagination.proto";
import "fairyring/common/shared_types.proto";
import "fairyring/pep/encrypted_tx.proto";
import "fairyring/pep/params.proto";
import "fairyring/pep/pep_nonce.proto";
import "gogoproto/gogo.proto";
import "google/api/annotations.proto";

option go_package = "github.com/Fairblock/fairyring/x/pep/types";

// Query defines the gRPC querier service.
service Query {
  // Parameters queries the parameters of the module.
  rpc Params(QueryParamsRequest) returns (QueryParamsResponse) {
    option (google.api.http).get = "/fairyring/pep/params";
  }

  // Queries a EncryptedTx by index.
  rpc EncryptedTx(QueryEncryptedTxRequest) returns (QueryEncryptedTxResponse) {
    option (google.api.http).get = "/fairyring/pep/encrypted_tx/{target_height}/{index}";
  }

  // Queries a list of EncryptedTx items.
  rpc EncryptedTxAll(QueryEncryptedTxAllRequest) returns (QueryEncryptedTxAllResponse) {
    option (google.api.http).get = "/fairyring/pep/encrypted_tx";
  }

  // Queries a list of EncryptedTx items.
  rpc EncryptedTxAllFromHeight(QueryEncryptedTxAllFromHeightRequest) returns (QueryEncryptedTxAllFromHeightResponse) {
    option (google.api.http).get = "/fairyring/pep/encrypted_tx/{target_height}";
  }

  // Queries a list of LatestHeight items.
  rpc LatestHeight(QueryLatestHeightRequest) returns (QueryLatestHeightResponse) {
    option (google.api.http).get = "/fairyring/pep/latest_height";
  }

  // Queries a PepNonce by index.
  rpc PepNonce(QueryPepNonceRequest) returns (QueryPepNonceResponse) {
    option (google.api.http).get = "/fairyring/pep/pep_nonce/{address}";
  }

  // Queries a list of PepNonce items.
  rpc PepNonceAll(QueryPepNonceAllRequest) returns (QueryPepNonceAllResponse) {
    option (google.api.http).get = "/fairyring/pep/pep_nonce";
  }

  // Queries the public keys
  rpc Pubkey(QueryPubkeyRequest) returns (QueryPubkeyResponse) {
    option (google.api.http).get = "/fairyring/pep/pubkey";
  }

  // Queries a General Identity request by identity
  rpc GeneralIdentity(QueryGeneralIdentityRequest) returns (QueryGeneralIdentityResponse) {
    option (google.api.http).get = "/fairyring/pep/general_identity/{identity}";
  }

  // Queries a list of General Identity requests
  rpc GeneralIdentityAll(QueryGeneralIdentityAllRequest) returns (QueryGeneralIdentityAllResponse) {
    option (google.api.http).get = "/fairyring/pep/general_identity";
  }

  // Queries a Private Identity request item by identity
  rpc PrivateIdentity(QueryPrivateIdentityRequest) returns (QueryPrivateIdentityResponse) {
    option (google.api.http).get = "/Fairblock/fairyring/pep/private_identity/{identity}";
  }

  // Queries a list of DecryptData items.
  rpc DecryptData(QueryDecryptDataRequest) returns (QueryDecryptDataResponse) {
    option (google.api.http).get = "/Fairblock/fairyring/pep/decrypt_data/{pubkey}/{decryption_key}/{encrypted_data}";
  }

  // VerifyWithdrawRangeProof verifies a withdraw range proof (U64)
  rpc VerifyWithdrawRangeProof(QueryVerifyWithdrawRangeProofRequest) returns (QueryVerifyWithdrawRangeProofResponse) {
    option (google.api.http).post = "/fairyring/pep/verify_withdraw_range_proof";
    option (google.api.http).body = "*";
  }

  // VerifyTransferRangeProof verifies a transfer range proof (U128)
  rpc VerifyTransferRangeProof(QueryVerifyTransferRangeProofRequest) returns (QueryVerifyTransferRangeProofResponse) {
    option (google.api.http).post = "/fairyring/pep/verify_transfer_range_proof";
    option (google.api.http).body = "*";
  }

  // VerifyValidityProof verifies a validity proof for grouped ciphertexts
  rpc VerifyValidityProof(QueryVerifyValidityProofRequest) returns (QueryVerifyValidityProofResponse) {
    option (google.api.http).post = "/fairyring/pep/verify_validity_proof";
    option (google.api.http).body = "*";
  }

  // VerifyEqualityProof verifies an equality proof between ciphertext and commitment
  rpc VerifyEqualityProof(QueryVerifyEqualityProofRequest) returns (QueryVerifyEqualityProofResponse) {
    option (google.api.http).post = "/fairyring/pep/verify_equality_proof";
    option (google.api.http).body = "*";
  }

  // VerifyTransferProofs verifies all transfer proofs together (equality, range, validity)
  rpc VerifyTransferProofs(QueryVerifyTransferProofsRequest) returns (QueryVerifyTransferProofsResponse) {
    option (google.api.http).post = "/fairyring/pep/verify_transfer_proofs";
    option (google.api.http).body = "*";
  }

  // VerifyWithdrawProofs verifies all withdraw proofs together (equality, range)
  rpc VerifyWithdrawProofs(QueryVerifyWithdrawProofsRequest) returns (QueryVerifyWithdrawProofsResponse) {
    option (google.api.http).post = "/fairyring/pep/verify_withdraw_proofs";
    option (google.api.http).body = "*";
  }
}

// QueryParamsRequest is request type for the Query/Params RPC method.
message QueryParamsRequest {}

// QueryParamsResponse is response type for the Query/Params RPC method.
message QueryParamsResponse {
  // params holds all the parameters of this module.
  Params params = 1 [
    (gogoproto.nullable) = false,
    (amino.dont_omitempty) = true
  ];
}

// QueryGeneralIdentityRequest is request type for the Query/GeneralIdentity RPC method.
message QueryGeneralIdentityRequest {
  string identity = 1;
}

// QueryGeneralIdentityResponse is response type for the Query/GeneralIdentity RPC method.
message QueryGeneralIdentityResponse {
  IdentityExecutionEntry request_details = 1;
}

// QueryGeneralIdentityAllRequest is request type for the Query/GeneralIdentityAll RPC method.
message QueryGeneralIdentityAllRequest {
  cosmos.base.query.v1beta1.PageRequest pagination = 1;
}

// QueryGeneralIdentityAllResponse is response type for the Query/GeneralIdentityAll RPC method.
message QueryGeneralIdentityAllResponse {
  repeated IdentityExecutionEntry request_details_list = 1;
  cosmos.base.query.v1beta1.PageResponse pagination = 2;
}

// QueryEncryptedTxRequest is request type for the Query/EncryptedTx RPC method.
message QueryEncryptedTxRequest {
  uint64 target_height = 1;
  uint64 index = 2;
}

// QueryEncryptedTxResponse is response type for the Query/EncryptedTx RPC method.
message QueryEncryptedTxResponse {
  EncryptedTx encrypted_tx = 1 [(gogoproto.nullable) = false];
}

// QueryEncryptedTxAllRequest is request type for the Query/EncryptedTxAll RPC method.
message QueryEncryptedTxAllRequest {
  cosmos.base.query.v1beta1.PageRequest pagination = 1;
}

// QueryEncryptedTxAllResponse is response type for the Query/EncryptedTxAll RPC method.
message QueryEncryptedTxAllResponse {
  repeated EncryptedTxArray encrypted_tx_array = 1 [(gogoproto.nullable) = false];
  cosmos.base.query.v1beta1.PageResponse pagination = 2;
}

// QueryEncryptedTxAllFromHeightRequest is request type for the Query/EncryptedTxAllFromHeight RPC method.
message QueryEncryptedTxAllFromHeightRequest {
  uint64 target_height = 1;
}

// QueryEncryptedTxAllFromHeightResponse is response type for the Query/EncryptedTxAllFromHeight RPC method.
message QueryEncryptedTxAllFromHeightResponse {
  EncryptedTxArray encrypted_tx_array = 1 [(gogoproto.nullable) = false];
}

// QueryLatestHeightRequest is request type for the Query/LatestHeight RPC method.
message QueryLatestHeightRequest {}

// QueryLatestHeightResponse is response type for the Query/LatestHeight RPC method.
message QueryLatestHeightResponse {
  uint64 height = 1;
}

// QueryPepNonceRequest is request type for the Query/PepNonce RPC method.
message QueryPepNonceRequest {
  string address = 1;
}

// QueryPepNonceResponse is response type for the Query/PepNonce RPC method.
message QueryPepNonceResponse {
  PepNonce pep_nonce = 1 [(gogoproto.nullable) = false];
}

// QueryPepNonceAllRequest is request type for the Query/PepNonceAll RPC method.
message QueryPepNonceAllRequest {
  cosmos.base.query.v1beta1.PageRequest pagination = 1;
}

// QueryPepNonceAllResponse is response type for the Query/PepNonceAll RPC method.
message QueryPepNonceAllResponse {
  repeated PepNonce pep_nonce = 1 [(gogoproto.nullable) = false];
  cosmos.base.query.v1beta1.PageResponse pagination = 2;
}

// QueryPubkeyRequest is request type for the Query/Pubkey RPC method.
message QueryPubkeyRequest {}

// QueryPubkeyResponse is response type for the Query/Pubkey RPC method.
message QueryPubkeyResponse {
  fairyring.common.ActivePublicKey active_pubkey = 1 [(gogoproto.nullable) = false];
  fairyring.common.QueuedPublicKey queued_pubkey = 2 [(gogoproto.nullable) = false];
}

// QueryPrivateIdentityRequest is request type for the Query/PrivateIdentity RPC method.
message QueryPrivateIdentityRequest {
  string identity = 1;
}

// QueryPrivateIdentityResponse is response type for the Query/PrivateIdentity RPC method.
message QueryPrivateIdentityResponse {
  string creator = 1;
  string identity = 2;
  string pubkey = 3;
  repeated fairyring.common.PrivateDecryptionKey private_decryption_keys = 4;
}

// QueryDecryptDataRequest is request type for the Query/DecryptData RPC method.
message QueryDecryptDataRequest {
  string pubkey = 1;
  string decryption_key = 2;
  string encrypted_data = 3;
}

// QueryDecryptDataResponse is response type for the Query/DecryptData RPC method.
message QueryDecryptDataResponse {
  string decrypted_data = 1;
}

// QueryVerifyWithdrawRangeProofRequest is request type for the Query/VerifyWithdrawRangeProof RPC method.
message QueryVerifyWithdrawRangeProofRequest {
  bytes proof_data = 1; // Serialized BatchedRangeProofU64Data
}

// QueryVerifyWithdrawRangeProofResponse is response type for the Query/VerifyWithdrawRangeProof RPC method.
message QueryVerifyWithdrawRangeProofResponse {
  bool valid = 1;
  string error = 2; // Empty if valid, error message if invalid
}

// QueryVerifyTransferRangeProofRequest is request type for the Query/VerifyTransferRangeProof RPC method.
message QueryVerifyTransferRangeProofRequest {
  bytes proof_data = 1; // Serialized BatchedRangeProofU128Data
}

// QueryVerifyTransferRangeProofResponse is response type for the Query/VerifyTransferRangeProof RPC method.
message QueryVerifyTransferRangeProofResponse {
  bool valid = 1;
  string error = 2; // Empty if valid, error message if invalid
}

// QueryVerifyValidityProofRequest is request type for the Query/VerifyValidityProof RPC method.
message QueryVerifyValidityProofRequest {
  bytes proof_data = 1; // Serialized BatchedGroupedCiphertext2HandlesValidityProofData
}

// QueryVerifyValidityProofResponse is response type for the Query/VerifyValidityProof RPC method.
message QueryVerifyValidityProofResponse {
  bool valid = 1;
  string error = 2; // Empty if valid, error message if invalid
}

// QueryVerifyEqualityProofRequest is request type for the Query/VerifyEqualityProof RPC method.
message QueryVerifyEqualityProofRequest {
  bytes proof_data = 1; // Serialized CiphertextCommitmentEqualityProofData
}

// QueryVerifyEqualityProofResponse is response type for the Query/VerifyEqualityProof RPC method.
message QueryVerifyEqualityProofResponse {
  bool valid = 1;
  string error = 2; // Empty if valid, error message if invalid
}

// QueryVerifyTransferProofsRequest is request type for the Query/VerifyTransferProofs RPC method.
// Contains all proofs needed for transfer verification: equality, range, and validity proofs
message QueryVerifyTransferProofsRequest {
  bytes equality_proof_data = 1; // Serialized CiphertextCommitmentEqualityProofData
  bytes range_proof_data = 2; // Serialized BatchedRangeProofU128Data
  bytes validity_proof_data = 3; // Serialized BatchedGroupedCiphertext2HandlesValidityProofData
}

// QueryVerifyTransferProofsResponse is response type for the Query/VerifyTransferProofs RPC method.
message QueryVerifyTransferProofsResponse {
  bool valid = 1;
  string error = 2; // Empty if valid, error message if invalid
}

// QueryVerifyWithdrawProofsRequest is request type for the Query/VerifyWithdrawProofs RPC method.
// Contains all proofs needed for withdraw verification: equality and range proofs
message QueryVerifyWithdrawProofsRequest {
  bytes equality_proof_data = 1; // Serialized CiphertextCommitmentEqualityProofData
  bytes range_proof_data = 2; // Serialized BatchedRangeProofU64Data
}

// QueryVerifyWithdrawProofsResponse is response type for the Query/VerifyWithdrawProofs RPC method.
message QueryVerifyWithdrawProofsResponse {
  bool valid = 1;
  string error = 2; // Empty if valid, error message if invalid
}
